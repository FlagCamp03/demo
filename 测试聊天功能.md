# 聊天功能测试指南

## 测试准备

### 1. 启动服务
```bash
# 启动后端服务
./gradlew bootRun

# 启动前端服务
cd frontend
npm run dev
```

### 2. 准备测试账户
- 确保有至少两个用户账户
- 确保有商品可以测试聊天功能

## 测试步骤

### 测试1: 基本聊天功能
1. **登录账户A**
2. **访问商品详情页**
3. **点击"Contact Seller"按钮**
4. **发送消息**: "Hi, I'm interested in your product"
5. **验证消息显示**: 确认消息出现在聊天界面
6. **刷新页面**: 确认消息仍然存在

### 测试2: 消息持久化
1. **发送多条消息**
2. **关闭浏览器**
3. **重新打开浏览器**
4. **登录账户A**
5. **访问同一商品的聊天页面**
6. **验证**: 所有历史消息都应该存在

### 测试3: 多用户聊天
1. **账户A发送消息**
2. **切换到账户B**
3. **访问同一商品的聊天页面**
4. **验证**: 能看到账户A发送的消息
5. **账户B回复消息**
6. **切换回账户A**
7. **验证**: 能看到账户B的回复

### 测试4: 实时更新
1. **在两个浏览器窗口打开同一聊天**
2. **窗口A发送消息**
3. **窗口B应该自动显示新消息**（3秒内）
4. **窗口B回复消息**
5. **窗口A应该自动显示回复**

### 测试5: 错误处理
1. **关闭后端服务**
2. **尝试发送消息**
3. **验证**: 显示错误提示
4. **重启后端服务**
5. **验证**: 功能恢复正常

## 预期结果

### ✅ 成功情况
- 消息能够正常发送和接收
- 聊天记录在刷新页面后仍然存在
- 多用户之间可以正常聊天
- 实时更新功能正常工作
- 错误处理友好

### ❌ 失败情况
- 消息发送失败
- 聊天记录丢失
- 无法看到其他用户的消息
- 实时更新不工作
- 错误提示不友好

## 故障排除

### 问题1: 消息发送失败
**可能原因**: 后端服务未启动或网络问题
**解决方案**: 
1. 检查后端服务是否运行
2. 检查浏览器控制台错误信息
3. 确认网络连接正常

### 问题2: 聊天记录丢失
**可能原因**: localStorage被清除或API调用失败
**解决方案**:
1. 检查浏览器localStorage
2. 查看后端日志
3. 确认数据库连接正常

### 问题3: 实时更新不工作
**可能原因**: 定时刷新被阻止或API调用失败
**解决方案**:
1. 检查浏览器控制台
2. 确认API端点正常
3. 检查网络连接

## 调试信息

### 浏览器控制台
- 查看网络请求
- 检查localStorage数据
- 查看错误信息

### 后端日志
- 查看API调用日志
- 检查数据库操作
- 确认消息保存状态

### 数据库检查
- 访问H2控制台: http://localhost:8080/h2-console
- 查看chat_rooms表
- 查看message表 